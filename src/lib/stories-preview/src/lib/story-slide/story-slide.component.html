<div
  class="media-container w-full h-screen p-4 flex items-center justify-center relative text-center"
>
  <ng-container *ngIf="story.mediaType === 'image'; else elseTemplate">
    <img [src]="story.mediaUrl" class="w-full h-full" alt="" />
  </ng-container>
  <ng-template #elseTemplate>
    <video controls>
      <source [src]="story.mediaUrl" />
    </video>
  </ng-template>

  <div
    class="absolute bottom-[36px] left-[50%] -translate-x-[50%] w-[90%] bg-gradient-to-r from-transparent via-black/70 to-transparent z-[1] p-3 flex flex-col gap-y-3 items-center justify-center"
  >
    <p class="text-sm truncate text-center">
      {{ story.mediaCaption }}
    </p>

    <button
      *ngIf="(authUser$ | async)?.username === author"
      type="button"
      class="bg-transparent flex items-center justify-center text-white gap-x-1 text-sm"
      (click)="viewWatched(story)"
    >
      <img
        src="assets/images/eye.png"
        alt="watched users"
        class="w-[20px] invert"
      />
      {{ story.watchedBy.length }}
    </button>
  </div>
</div>

<p-dialog
  header="Header"
  [(visible)]="watchedDialogvisible"
  [position]="'bottom'"
  [style]="{ width: '30vw' }"
  [breakpoints]="{ '960px': '75vw', '640px': '90vw' }"
  (onHide)="watchedDialogvisible = false"
  [baseZIndex]="2221"
>
  <ng-template pTemplate="header">
    <div class="text-sm">Viewed By: {{ story.watchedBy.length }}</div>
  </ng-template>

  <ng-template pTemplate="headless">
    <div
      class="bg-gradient-to-r from-primaryColor to-secondaryColor text-white p-3"
    >
      <ng-container *ngIf="watchedBy.length; else elseTemplate">
        <ul class="p-0 m-0 max-h-[50vh] lg:max-h-[30vh] overflow-auto">
          <li
            class="w-full flex items-center space-x-4 py-2"
            *ngFor="let user of watchedBy"
          >
            <img
              class="inline-block flex-shrink-0 h-[3rem] w-[3rem] rounded-full"
              [src]="
                user.user.imageUrl
                  ? user.user.imageUrl
                  : 'assets/images/users/default.jpg'
              "
              [attr.alt]="user.user.username"
            />

            <div>
              <span class="text-sm font-bold block"
                >{{ user.user.firstname }} {{ user.user.lastname }}</span
              >
              <span class="inline-block italic text-xs">{{
                formatTimeWatched(user.watchedAt)
              }}</span>
            </div>
          </li>
        </ul>
      </ng-container>
      <ng-template #elseTemplate>
        <span class="italic text-xs">No user has viewed this story yet!!!</span>
      </ng-template>
    </div>
  </ng-template>
</p-dialog>
